 # Week2
 | SI.No |  Action Item  | Status|
 | ----- | ------------- |-------|
 |  1    | Install Align  |:heavy_check_mark:|
 |  2    | Postlayout Characteristics of Inverter using Align|:heavy_check_mark:|
 |  3    | Compare Postlayout Char of Align vs Magic         |:heavy_check_mark:|
 |  4    | Design and Simulation of Complex Fn using Sky130 PDKs|:heavy_check_mark:|
 |  5    | Postlayout Characteristics of Complex Function using Magic|:heavy_check_mark: |
 |  6    | Postlayout Characteristics Fn function using Align|:o:|
 |  7    | LVS of Inverter And Fn function|:o:|
# Installation of ALIGN
- ALIGN (Analog Layout, Intelligently Generated from Netlists) is to automatically translate an unannotated (or partially annotated) SPICE netlist of an     analog circuit to a GDSII layout. Follow the command to install: 
 ```
  $ export CC=/usr/bin/gcc
  $ export CXX=/usr/bin/g++
  $ git clone https://github.com/ALIGN-analoglayout/ALIGN-public
  $ cd ALIGN-public

  $ #Create a Python virtualenv
  $ python -m venv general
  $ source general/bin/activate
  $ python -m pip install pip --upgrade

  # Install ALIGN as a USER
  $ pip install -v .

  # Install ALIGN as a DEVELOPER
  $ pip install -e .

  $ pip install setuptools wheel pybind11 scikit-build cmake ninja
  $ pip install -v -e .[test] --no-build-isolation
  $ pip install -v --no-build-isolation -e . --no-deps --install-option='-DBUILD_TESTING=ON'
 ```
  for more info refer : [https://github.com/sanampudig/OpenFASoC/tree/main/AUXCELL](https://github.com/sanampudig/OpenFASoC/tree/main/AUXCELL)
##  Linking ALIGN with Sky130 PDK
  - Clone the repo <br/>
     `git clone https://github.com/ALIGN-analoglayout/ALIGN-pdk-sky130` <br/>
     mv `SKY130_PDK` to `../ALIGN-public/pdks` <br/>
## Testing ALIGN
### Running ALIGN TOOL
-  Everytime we start running tool in new terminal run following commands.<br/>
   ```
   python3 -m venv general
   source general/bin/activate
   ```
- Commands to run ALIGN (goto ALIGN-public directory)<br/>
   ```
   mkdir work
   cd work
   ```
 - Syntax to Generate .lef,.gds files <br/>
   `schematic2layout.py <NETLIST_DIR> -p <PDK_DIR> -c`
 - Running a EXAMPLE:
   `schematic2layout.py ../ALIGN-pdk-sky130/examples/five_transistor_ota -p ../pdks/SKY130_PDK/`
 -   Now open the .lef  ,  .gds files in klayout <br/>
                  GDS File      |   LEF File
     :-------------------------:|:-------------------------:
   ![](https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/Images/ota_5t_gds.png)|![](https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/Images/ota_5t_lef.png)
     
## Prelayout Simulation of CMOS Inverter
### Pre-layout Characterization using Xschem/Ngspice (Subcircuit):

 ![inverter](https://user-images.githubusercontent.com/53760504/221830953-1a38ad6a-911d-4f78-ab33-759f85a751d8.png)

 ![inverter_sym](https://user-images.githubusercontent.com/53760504/221830979-db393885-3469-40a3-83c2-076da6378860.png)

 ![trans_inv](https://user-images.githubusercontent.com/53760504/221831600-e8fd8366-8742-460f-9cc9-74e1f595706b.png)

## Post-Layout of Inverter using ALIGN
- Create a Netlist with .sp extension.This Netlist is Different in terms of Parameters to That one Generated by Xschem.
```
.subckt inverter A B vdd vss
XM1 B A vdd vdd sky130_fd_pr__pfet_01v8 w=21e-7 l=0.15n nf=10 m=1
XM2 B A vss vss sky130_fd_pr__nfet_01v8 w=21e-7 l=0.15n nf=10 m=1
.ends

```
- Now Run the Following Move to General Environment:<br/>
`schematic2layout.py ../ALIGN-pdk-sky130/examples/inverter/ -p ../pdks/SKY130_PDK/`
 <img src="https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/Images/inverter_align.png" width="800" height="500">
- The lef and gds Files Generated By Align of Inverter <br/>
   
   ![](https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/Images/inverter_gds.png)
   ![](https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/Images/inverter_lef.png)|

- To read the GDS file in magic Click on READ GDS and Select the INVERTER_0.gds <br/>
- ![inverter_mag](https://user-images.githubusercontent.com/53760504/222423915-63c2d6f6-2993-4cab-bfb7-36679fd15079.png)

- Here is the Modified Netlist of the Inverter after Extraction <br/>
```
* SPICE3 file created from INVERTER_0.ext - technology: sky130A
.lib /usr/local/share/pdk/sky130A/libs.tech/ngspice/sky130.lib.spice tt

x1 A B VDD VSS inverter



.subckt inverter A B VDD VSS
X0 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=2.94e+12p pd=2.38e+07u as=3.465e+12p ps=2.85e+07u w=2.1e+06u l=150000u
X1 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X2 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X3 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X4 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X5 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X6 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X7 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X8 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X9 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X10 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=2.94e+12p pd=2.38e+07u as=3.465e+12p ps=2.85e+07u w=2.1e+06u l=150000u
X11 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X12 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X13 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X14 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X15 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X16 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X17 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X18 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X19 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
C0 A VDD 2.60fF
C1 B VDD 4.03fF
C2 B A 1.20fF
C3 B VSS 3.35fF 
C4 A VSS 2.98fF 
C5 VDD VSS 5.63fF 

.ends
Vgnd VSS 0 0 
VDD VDD VSS 1.8
Vin A  VSS 0
* create pulse 
* Vin A VSS pulse(0 1.8 1p 10p 10p 1n 2n)

* create PWL 
* Vin A VSS pwl(0 1.8v 5n 1.8v 5.1n 0 10n 0)
* .tran 10p 10n


.dc Vin 0 1.8 0.01


.control
  run 
  plot A B
.endc 

.end

```
- DC Analysis of Inverter : <br/>
![dc_analysis_nm](https://user-images.githubusercontent.com/53760504/222424153-a64cc35a-8bde-42a1-9248-6d131a7d1b91.png)
- Transient Analysis : <br/>
![inverter_align_trans](https://user-images.githubusercontent.com/53760504/222424087-9654b558-5777-4bcc-822f-561e6168628e.png)

## Manual Layout of Inverter:

## Comparision of Inverter Post-layout Charactristic of Align,Manual: <br/>
|Parameters                           | Align| Manual |
|-------------------------------------|------|--------|
| Rise Time(Tpdr)|      |        |
| Fall Time(Tpdf)|      |        |
| High to Low Propagation Delay(Tph-l)|      |        |
| Low to High Propagation Delay(Tpl-h)|      |        |

## Simulation Of Complex Function <br/>
### Pre-layout Analysis of Complex Function <br/>
-  Fn= [(B+D).(A+C)+E.F]'
- Schematic:
  
 ![fN](https://user-images.githubusercontent.com/53760504/222424488-ba28a761-d01a-4114-9aca-8e95696dd7bc.png)
 
![fn_tb](https://user-images.githubusercontent.com/53760504/222424612-b4c7d84d-94cd-4aea-8932-d7106acfea1b.png)
![FN_2](https://user-images.githubusercontent.com/53760504/222424695-6fc035a3-da30-4daa-8f10-02af7853bb1e.png)
![fn_out](https://user-images.githubusercontent.com/53760504/222424867-bf73d083-196e-4762-af5d-13229610920e.png)

## Post-layout Characteristics of Fn Function Using ALIGN:<br/>
- The Netlist for Generating Fn Function:<br/>
```
.subckt Fn A B C D E F Y vdd vss
XM1 net1 A vdd vdd sky130_fd_pr__pfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM2 net3 B vdd vdd sky130_fd_pr__pfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM3 net2 C net1 net1 sky130_fd_pr__pfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM4 net2 D net3 net3 sky130_fd_pr__pfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM5 Y E net2 net2 sky130_fd_pr__pfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM6 Y F net2 net2 sky130_fd_pr__pfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM7 Y A net4 net4 sky130_fd_pr__nfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM8 Y C net4 net4 sky130_fd_pr__nfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM9 Y E net5 net5 sky130_fd_pr__nfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM10 net4 B vss vss sky130_fd_pr__nfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM11 net4 D vss vss sky130_fd_pr__nfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
XM12 net5 F vss vss sky130_fd_pr__nfet_01v8 L=0.15e-9 W=21e-7 nf=10 m=1
.ends
```
Run the Get Netlist:<br/>
`schematic2layout.py ../ALIGN-pdk-sky130/examples/Fn/ -p ../pdks/SKY130_PDK/`
- Here are the GDS and Lef Files in Klayout:<br/>
![Fn_gds](https://user-images.githubusercontent.com/53760504/222425811-69aae4e4-5df3-4c88-8a8a-c90f56ddfcc5.png)
![Fn_lef](https://user-images.githubusercontent.com/53760504/222425814-c18b256b-2e37-4bae-9f6c-df046e0b26a6.png)

- Open the GDS file in Magic<br/>
- ![Fn_mag](https://user-images.githubusercontent.com/53760504/222426571-0a997709-99b6-42df-ab42-d347b8c011ef.png)
- The Extracted Netlist is As Follows [FN_0.spice](https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/mag/FN_0.spice)


```
vinayreddy@vsd-mspdr:~/Desktop/mspdr/ALIGN-public/work/mag$ ngspice FN_0.spice
******
** ngspice-39 : Circuit level simulation program
** The U. C. Berkeley CAD Group
** Copyright 1985-1994, Regents of the University of California.
** Copyright 2001-2022, The ngspice team.
** Please get your ngspice manual from http://ngspice.sourceforge.net/docs.html
** Please file your bug-reports at http://ngspice.sourceforge.net/bugrep.html
** Creation Date: Tue Feb 10 08:15:11 UTC 2023
******

Note: No compatibility mode selected!


Circuit: * spice3 file created from fn_0.ext - technology: sky130a

ngspice 2 -> plot Y
Error: no such vector Y
ngspice 3 -> 


```
## Post- Layout of Fn using Magic
