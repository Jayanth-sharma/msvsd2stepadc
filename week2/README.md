 # Week2
 | SI.No |  Action Item  | Status|
 | ----- | ------------- |-------|
 |  1    | Install Align  |:heavy_check_mark:|
 |  2    | Postlayout Characteristics of Inverter using Align|:heavy_check_mark:|
 |  3    | Compare Postlayout Char of Align vs Magic         |:heavy_check_mark:|
 |  4    | Design and Simulation of Complex Fn using Sky130 PDKs|:o:|
 |  5    | Postlayout Characteristics of Complex Function using Magic|:o: |
 |  6    | Postlayout Characteristics using Align|:o:|
# Installation of ALIGN
- ALIGN (Analog Layout, Intelligently Generated from Netlists) is to automatically translate an unannotated (or partially annotated) SPICE netlist of an     analog circuit to a GDSII layout. Follow the command to install: 
 ```
  $ export CC=/usr/bin/gcc
  $ export CXX=/usr/bin/g++
  $ git clone https://github.com/ALIGN-analoglayout/ALIGN-public
  $ cd ALIGN-public

  $ #Create a Python virtualenv
  $ python -m venv general
  $ source general/bin/activate
  $ python -m pip install pip --upgrade

  # Install ALIGN as a USER
  $ pip install -v .

  # Install ALIGN as a DEVELOPER
  $ pip install -e .

  $ pip install setuptools wheel pybind11 scikit-build cmake ninja
  $ pip install -v -e .[test] --no-build-isolation
  $ pip install -v --no-build-isolation -e . --no-deps --install-option='-DBUILD_TESTING=ON'
 ```
  for more info refer : [https://github.com/sanampudig/OpenFASoC/tree/main/AUXCELL](https://github.com/sanampudig/OpenFASoC/tree/main/AUXCELL)
##  Linking ALIGN with Sky130 PDK
  - Clone the repo <br/>
     `git clone https://github.com/ALIGN-analoglayout/ALIGN-pdk-sky130` <br/>
     mv `SKY130_PDK` to `../ALIGN-public/pdks` <br/>
## Testing ALIGN
### Running ALIGN TOOL
-  Everytime we start running tool in new terminal run following commands.<br/>
   ```
   python3 -m venv general
   source general/bin/activate
   ```
- Commands to run ALIGN (goto ALIGN-public directory)<br/>
   ```
   mkdir work
   cd work
   ```
 - Syntax to Generate .lef,.gds files <br/>
   `schematic2layout.py <NETLIST_DIR> -p <PDK_DIR> -c`
 - Running a EXAMPLE:
   `schematic2layout.py ../ALIGN-pdk-sky130/examples/five_transistor_ota -p ../pdks/SKY130_PDK/`
 -   Now open the .lef  ,  .gds files in klayout <br/>
                  GDS File      |   LEF File
     :-------------------------:|:-------------------------:
     ![](https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/Images/ota_5t_gds.png)  |  ![](https://github.com/Jayanth-sharma/msvsd2stepadc/blob/main/week2/Images/ota_5t_lef.png)
     
## Prelayout Simulation of CMOS Inverter
### Pre-layout Characterization using Xschem/Ngspice (Subcircuit):

 ![inverter](https://user-images.githubusercontent.com/53760504/221830953-1a38ad6a-911d-4f78-ab33-759f85a751d8.png)

 ![inverter_sym](https://user-images.githubusercontent.com/53760504/221830979-db393885-3469-40a3-83c2-076da6378860.png)

 ![trans_inv](https://user-images.githubusercontent.com/53760504/221831600-e8fd8366-8742-460f-9cc9-74e1f595706b.png)

## Post-Layout of Inverter using ALIGN
- Create a Netlist with .sp extension.This Netlist is Different in terms of Parameters to That one Generated by Xschem.
```
.subckt inverter A B vdd vss
XM1 B A vdd vdd sky130_fd_pr__pfet_01v8 w=21e-7 l=0.15n nf=10 m=1
XM2 B A vss vss sky130_fd_pr__nfet_01v8 w=21e-7 l=0.15n nf=10 m=1
.ends

```
- Now Run the Following Move to General Environment:<br/>
`schematic2layout.py ../ALIGN-pdk-sky130/examples/inverter/ -p ../pdks/SKY130_PDK/`
- The lef and gds Files Generated By Align of Inverter <br/>
             GDS File      |   LEF File
     :-------------------------:|:-------------------------:
     ![]()  |  ![]()
- To read the GDS file in magic Click on READ GDS and Select the INVERTER_0.gds <br/>
- Here is the Modified Netlist of the Inverter<br/>
```
* SPICE3 file created from INVERTER_0.ext - technology: sky130A
.lib /usr/local/share/pdk/sky130A/libs.tech/ngspice/sky130.lib.spice tt

x1 A B VDD VSS inverter



.subckt inverter A B VDD VSS
X0 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=2.94e+12p pd=2.38e+07u as=3.465e+12p ps=2.85e+07u w=2.1e+06u l=150000u
X1 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X2 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X3 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X4 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X5 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X6 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X7 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X8 B A VDD VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X9 VDD A B VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X10 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=2.94e+12p pd=2.38e+07u as=3.465e+12p ps=2.85e+07u w=2.1e+06u l=150000u
X11 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X12 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X13 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X14 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X15 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X16 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X17 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X18 VSS A B VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
X19 B A VSS VSS sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=2.1e+06u l=150000u
C0 A VDD 2.60fF
C1 B VDD 4.03fF
C2 B A 1.20fF
C3 B VSS 3.35fF 
C4 A VSS 2.98fF 
C5 VDD VSS 5.63fF 

.ends
Vgnd VSS 0 0 
VDD VDD VSS 1.8
Vin A  VSS 0
* create pulse 
* Vin A VSS pulse(0 1.8 1p 10p 10p 1n 2n)

* create PWL 
* Vin A VSS pwl(0 1.8v 5n 1.8v 5.1n 0 10n 0)
* .tran 10p 10n


.dc Vin 0 1.8 0.01


.control
  run 
  plot A B
.endc 

.end

```
- DC Analysis of Inverter : <br/>
- Transient Analysis : <br/>

## Manual Layout of Inverter:

## Comparision of Inverter Post-layout Charactristic of Align,Manual: <br/>
|Parameters                           | Align| Manual |
|----------------------------------- -|------|--------|
| Rise Time(Tpdr)                     |      |        |
| Fall Time(Tpdf)                     |      |        |
| High to Low Propagation Delay(Tph-l)|      |        |
| Low to High Propagation Delay(Tpl-h)|      |        |
## Simulation Of Complex Function <br/>
### Pre-layout Analysis of Complex Function <br/>
-  Fn= [(B+D).(A+C)+E.F]'
- Schematic:
  
